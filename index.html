<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=1024, user-scalable=no">

	<title>COUCHDB</title>
	
	<!-- Required stylesheet -->
	<link rel="stylesheet" href="core/deck.core.css">
	
	<!-- Extension CSS files go here. Remove or add as needed. -->
	<link rel="stylesheet" href="extensions/goto/deck.goto.css">
	<link rel="stylesheet" href="extensions/menu/deck.menu.css">
	<link rel="stylesheet" href="extensions/navigation/deck.navigation.css">
	<link rel="stylesheet" href="extensions/status/deck.status.css">
	<link rel="stylesheet" href="extensions/hash/deck.hash.css">
	<link rel="stylesheet" href="extensions/scale/deck.scale.css">
    <link rel="stylesheet" href="extensions/codemirror/deck.codemirror.css">
    <link rel="stylesheet" href="extensions/codemirror/themes/default.css">
	<!-- Style theme. More available in /themes/style/ or create your own. -->
	<link rel="stylesheet" href="themes/style/web-2.0.css">
	
	<!-- Transition theme. More available in /themes/transition/ or create your own. -->
	<link rel="stylesheet" href="themes/transition/horizontal-slide.css">
	
	<!-- Required Modernizr file -->
	<script src="modernizr.custom.js"></script>
</head>
<body class="deck-container">

<!-- Begin slides. Just make elements with a class of slide. -->

<section class="slide" id="hello">
 <h1>couchdb</h1>
        <p>Taking a REST on the GeoCouch</p>
</section>

<section class="slide" id="wtf">
<h2>WTF?</h2>
                <ul>
                    <li class="slide" id="nosql">CouchDB is a NOSQL database</li>
                    <li class="slide" id="json">Instead or "Rows" it has "Documents", these are written in JSON</li>
                    <li class="slide" id="mapred">Instead of SQL it&nbsp;uses Map/Reduce</li>
                    <li class="slide" id="dd">Instead of Queries it has Design Documents</li>
                    <li class="slide" id="jce">Design Documents are written in JavaScript or CoffeeScript (or Erlang if you enable it).</li>
                </ul>

</section><section class="slide" id="REST">
<h2>It has a RESTful interface</h2>
   
                <ul>

<li class="slide" id="get">you get a document with a GET request</li>
<li class="slide" id="delete">delete with DELETE</li>
<li class="slide" id="putpost">and add with PUT or POST</li>
<li class="slide" id="putpost">your reponse is JSON</li>
<li class="slide" id="fullStop">that is it, no driver needed, most language specific frameworks are actually built around an equivelent of CURL</li>
</ul>
       
</section>
<section class="slide" id="setup"><h2>Example Project</h2><ul>
<li class="slide" id="getData">Use a cell phone to take a reading of it's location, all the wifi networks it can see, and their reletive strengths</li>
<li class="slide" id="getMore">Repeat</li>
<li class="slide" id="getEvenMore">Alot</li>
<li class="slide" id="getMAC">Be able to look up by MAC and get location</li>
<li class="slide" id="wigle">Based off idea behind <a href="http://wigle.net" target="_blank">Wigle</a></li>
<li class="slide" id="colection">Collected Data using their Android app.</li>


</ul></section>
<section class="slide" id="doc">
 <h2>
       DOC
   
    </h2>
<textarea class="code" mode="javascript">{
    "_id":"2c5012b8970716cd25444d520800e260",
    "_rev":"1-6eafb16ed8cc5b7820314ba57c1f938a",
    "networks":[
        {
            "Kind":"WIFI",
            "fs":"2012-08-28 17:11:42",
            "SSID":"1106 6310",
            "MAC":"00:24:c8:24:48:00",
            "ch":"6",
            "strength":"-97",
            "modes":"[WEP]"
        },
        {
            "Kind":"WIFI",
            "fs":"2012-08-28 17:11:42",
            "SSID":"ScanIt_Mobile",
            "MAC":"00:15:2c:48:33:10",
            "ch":"6",
            "strength":"-97",
            "modes":"[ESS]"
        }
    ],
    "point":{
        "acc":"3",
        "loc":{
            "lat":"42.25301085",
            "lng":"-70.9934717333"
        },
        "alt":"13.8"
    }
}</textarea>

</section>
<section class="slide" id="ddoc">


<h2>Design Doc</h2>
<textarea class="code" mode="javascript">{
    "_id":"_design/whatever",
    "views":{
        "ViewName":{
            "map": MAP FUNCTION,
            "reduce": REDUCE FUNCTION
        },
        "OtherViewName":{
            "map": MAP FUNCTION,
            "reduce": REDUCE FUNCTION
        }
    },
    "lists":{
        "listName":function, we'll get to this
    },
    "etc":{
        "name": there are a few different types, we won't get to all
    }
    
}</textarea>
</section><section class="slide" id="map">
    <h2>
        MAP
    </h2><textarea class="code" mode="javascript">
function(doc) {
   if(doc.networks && doc.networks.length>0){
        if(doc.point&&doc.point.acc&&parseInt(doc.point.acc)<100){    
            var geometry= {
                "type": "Point",
                coordinates:[               
                    parseFloat(doc.point.loc.lng),
                    parseFloat(doc.point.loc.lat),
                    parseInt(doc.point.alt)
                ]
            };
            doc.networks.forEach(function(m){
                var out ={geometry:geometry};
                out.strength=parseInt(m.strength);
                out.SSID=m.SSID;
                out.MAC=m.MAC;
                emit(m.MAC,out);
            })
        }
    }
}
</textarea>
</section><section class="slide" id="reduce"><h2>REDUCE</h2><textarea class="code" mode="javascript">function (key, values){
    function red(a,b){
        var wa = Math.pow(a.strength,2);
        var wb = Math.pow(b.strength,2);
        var qa=wa/(wa+wb);
        var qb=wb/(wa+wb);
        var r={
            SSID:a.SSID,
            MAC:a.MAC,
            geometry:{
                "type": "Point"
            }
        };
        function weightedAverage(v,i){
                return (v*qa)+(b.geometry.coordinates[i]*qb);
        }
        r.geometry.coordinates=a.geometry.coordinates.map(weightedAverage);
        r.strength=(a.strength*qa)+(b.strength*qb);
        return r;
    }
    return values.reduce(red);
}</textarea></section><section class="slide" id="result"><h2>key="f4:ec:38:c1:99:10"</h2>
<textarea class="code" mode="javascript">{
    "rows":[
        {
            "key":null,
            "value":{
                "SSID":"Rachvin",
                "MAC":"f4:ec:38:c1:99:10",
                "geometry":{
                    "type":"Point",
                    "coordinates":[
                        -70.987100140176437435,
                        42.249797198590130165,
                        13.03995438124339401
                    ]
                },
                "strength":-81.524215627584908361
            }
        }
    ]
}</textarea></section>
<section class="slide" id="results"><h2>group=true&limit=2&startkey="f4:ec:38:c1:99:10"</h2>
<textarea class="code" mode="javascript">{
    "rows":[
        {
            "key":"f4:ec:38:c1:99:10",
            "value":{
                "SSID":"Rachvin",
                "MAC":"f4:ec:38:c1:99:10",
                "geometry":{
                    "type":"Point",
                    "coordinates":[
                        -70.98752037870970355,
                        42.249932564158058312,
                        13.525162057459191089
                    ]
                },
                "strength":-81.858036681635525156
            }
        },
        {
            "key":"f4:ec:38:ec:85:fe",
            "value":{
                "geometry":{
                    "type":"Point",
                    "coordinates":[
                        -71.053958783300004143,
                        42.364249083300002496,
                        31
                    ]
                },
                "strength":-99,
                "SSID":"free internet my ass ..",
                "MAC":"f4:ec:38:ec:85:fe"
            }
        }
    ]
}</textarea></section><section class="slide" id="example"><h2>try f4:ec:38:c1:99:10</h2><iframe src="http://calvin.iriscouch.com/w/_design/w/index.html" width="900" height="600"></iframe></section>
<section class="slide" id="spatial"><h2>spatial</h2>
<textarea class="code" mode="javascript">function (doc){
    if(doc.geometry){
        emit(doc.geometry, doc);
    }
}
</textarea></section><section class="slide" id="spatialist"><h2>spatial list (spatialist)</h2>
<textarea class="code" mode="javascript">function (head, req){
    var row, out, sep = '\\n';
    if (typeof(req.headers.Accept) != "undefined" && req.headers.Accept.indexOf('application/json')!=-1){
        start({"headers":{"Content-Type" : "application/json"}});
    }else{
        start({"headers":{"Content-Type" : "text/plain"}});
    }
    if ('callback' in req.query){
        send(req.query['callback'] + "(");
    }
    send('{"type": "FeatureCollection", "features":[');
    while (row = getRow()) {
        out = '{"type": "Feature", "id": ' + JSON.stringify(row.id);
        out += ', "geometry": ' + JSON.stringify(row.value.geometry);
        delete row.value.geometry;
        out += ', "properties": ' + JSON.stringify(row.value) + '}';
        send(sep + out);
        sep = ',\\n';
    }
    send("]}");
    if ('callback' in req.query){
        send(")");
    }
}</textarea></section>
<!-- End slides. -->


<!-- Begin extension snippets. Add or remove as needed. -->

<!-- deck.navigation snippet -->
<a href="#" class="deck-prev-link" title="Previous">&#8592;</a>
<a href="#" class="deck-next-link" title="Next">&#8594;</a>

<!-- deck.status snippet -->
<p class="deck-status">
	<span class="deck-status-current"></span>
	/
	<span class="deck-status-total"></span>
</p>

<!-- deck.goto snippet -->
<form action="." method="get" class="goto-form">
	<label for="goto-slide">Go to slide:</label>
	<input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
	<datalist id="goto-datalist"></datalist>
	<input type="submit" value="Go">
</form>

<!-- deck.hash snippet -->
<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<!-- End extension snippets. -->


<!-- Required JS files. -->
<script src="jquery-1.7.2.min.js"></script>
<script src="core/deck.core.js"></script>

<!-- Extension JS files. Add or remove as needed. -->
<script src="core/deck.core.js"></script>
<script src="extensions/hash/deck.hash.js"></script>
<script src="extensions/menu/deck.menu.js"></script>
<script src="extensions/goto/deck.goto.js"></script>
<script src="extensions/status/deck.status.js"></script>
<script src="extensions/navigation/deck.navigation.js"></script>
<script src="extensions/scale/deck.scale.js"></script>
<script src="extensions/codemirror/deck.codemirror.js"></script>
<script src="extensions/codemirror/codemirror.js"></script>
<script src="extensions/codemirror/mode/javascript/javascript.js"></script>
<!-- Initialize the deck. You can put this in an external file if desired. -->
<script>
	$(function() {
		$.deck('.slide');
	});
</script>
</body>
</html>
